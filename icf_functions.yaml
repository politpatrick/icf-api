# .github/functions/icf_functions.yaml

name: icf_json_exporter
description: >
  CustomGPT-Action zum Exportieren des ICF-ClaML-XML in eine
  hierarchische JSON-Struktur sowie zum Nachladen, Analysieren und
  Pflegen dieser Daten.
version: 1.0.0

functions:

  - name: export_icf
    description: >
      Exportiert das ICF-ClaML-XML in eine Verzeichnisstruktur aus
      JSON-Dateien. Erzeugt unterhalb von target_dir je Code-Verzeichnis
      eine Datei code.json sowie eine globale index.json.
    parameters:
      type: object
      required: [xml_path, target_dir]
      properties:
        xml_path:
          type: string
          description: Pfad zur ICF-ClaML-XML-Datei (z.B. icf2005syst_claml_20120619.xml)
        target_dir:
          type: string
          description: Zielordner für die Ausgabe (z.B. ./icf_json)
        lang:
          type: string
          description: ISO-Sprachcode (z.B. de, en)
          default: de

  - name: create_flat_json
    description: >
      Erstellt unter target_dir/icf_flat.json eine einzelne Datei,
      die alle Klassen-Daten (Code → JSON-Objekt) beinhaltet.
      Fehlende Einträge werden übersprungen.
    parameters:
      type: object
      required: [target_dir]
      properties:
        target_dir:
          type: string
          description: Ordner mit exportierten JSON-Dateien
        fname:
          type: string
          description: Name der Flat-File
          default: icf_flat.json

  - name: stats
    description: >
      Ermittelt Basis-Statistiken (Anzahl Klassen, maximale Baumtiefe,
      durchschnittliche Kinderzahl). Fehlende Dateien werden übersprungen.
    parameters:
      type: object
      required: [target_dir]
      properties:
        target_dir:
          type: string
          description: Ordner mit exportierten JSON-Dateien

  - name: load_class
    description: >
      Lädt eine einzelne Klassen-JSON anhand des Codes aus dem index.json.
    parameters:
      type: object
      required: [code, index_path]
      properties:
        code:
          type: string
          description: ICF-Code (z.B. b110)
        index_path:
          type: string
          description: Pfad zur index.json

  - name: search_text
    description: >
      Durchsucht ausgewählte Text-Felder (preferred, definitions,
      coding-hints) nach einem Suchbegriff und liefert die Treffer.
    parameters:
      type: object
      required: [query, index_path]
      properties:
        query:
          type: string
          description: Suchbegriff
        index_path:
          type: string
          description: Pfad zur index.json
        fields:
          type: array
          items:
            type: string
          description: Liste der zu durchsuchenden Felder
          default: ["preferred", "definitions", "coding-hints"]
        limit:
          type: integer
          description: Maximale Anzahl an Treffern
          default: 20

  - name: list_children
    description: >
      Gibt alle Kind-Codes einer Klasse bis zu einer bestimmten Tiefe
      zurück (inklusive direkter Unterklassen).
    parameters:
      type: object
      required: [code, index_path]
      properties:
        code:
          type: string
          description: Eltern-Code (z.B. b)
        index_path:
          type: string
          description: Pfad zur index.json
        depth:
          type: integer
          description: Rekursionstiefe (1 = nur direkte Kinder)
          default: 1

  - name: update_cache
    description: >
      Führt einen erneuten Export mit export_icf aus und überschreibt
      ältere Dateien – nützlich, um XML-Änderungen einzupflegen.
    parameters:
      type: object
      required: [xml_path, target_dir]
      properties:
        xml_path:
          type: string
          description: Pfad zur ICF-ClaML-XML-Datei
        target_dir:
          type: string
          description: Zielordner
        lang:
          type: string
          description: ISO-Sprachcode
          default: de

  - name: export_language
    description: >
      Alias für export_icf, um parallel alternative Sprachen (en, fr etc.)
      zu exportieren, ohne die Standard-Routine zu ändern.
    parameters:
      type: object
      required: [xml_path, target_dir, lang]
      properties:
        xml_path:
          type: string
          description: Pfad zur ICF-ClaML-XML-Datei
        target_dir:
          type: string
          description: Sprachspezifischer Zielordner
        lang:
          type: string
          description: ISO-Sprachcode der Ausgabe